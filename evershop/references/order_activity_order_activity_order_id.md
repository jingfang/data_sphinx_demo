| path | summary | is relevant |
| --- | --- | --- |
| [packages/evershop/src/modules/checkout/migration/Version-1.0.0.js](https://github.com/evershopcommerce/evershop/blob/4f1f4947f95e03b9cf64486a42b1669d484cba61/packages/evershop/src/modules/checkout/migration/Version-1.0.0.js) | <br><br>テーブルorder_activityのカラムorder_activity_order_idは、外部キー制約として使用されています。具体的には、このカラムはorderテーブルのorder_idカラムを参照しています。つまり、order_activityテーブルの各行は、orderテーブルの特定の注文に関連付けられていることを示しています。この関連付けは、FK_ORDER_ACTIVITYという名前の外部キー制約によって確立されています。 | True |
| [packages/evershop/src/modules/cod/api/codCapturePayment/[bodyParser]capture.js](https://github.com/evershopcommerce/evershop/blob/bc7ee43cdadfb8a00e896c8f753da75938507854/packages/evershop/src/modules/cod/api/codCapturePayment/[bodyParser]capture.js) | このコードでは、テーブルorder_activityのカラムorder_activity_order_idは、insertメソッドで新しいorder_activityレコードを作成する際に、与えられた値として使用されています。具体的には、以下のようになっています。<br><br>```<br>await insert('order_activity')<br>  .given({<br>    order_activity_order_id: order.order_id, // ここでorder_activity_order_idが使用されている<br>    comment: 'Customer paid using cash.',<br>    customer_notified: 0 // TODO: check config of SendGrid<br>  })<br>  .execute(pool);<br>```<br><br>つまり、order_activity_order_idには、変数orderのorder_idが与えられ、その値が新しいorder_activityレコードのorder_activity_order_idカラムに保存されます。これにより、order_activityレコードとorderレコードが関連付けられます。 | True |
| [packages/evershop/src/modules/checkout/api/updateShipment/updateShipment.js](https://github.com/evershopcommerce/evershop/blob/bc7ee43cdadfb8a00e896c8f753da75938507854/packages/evershop/src/modules/checkout/api/updateShipment/updateShipment.js) | このコードでは、テーブルorder_activityのカラムorder_activity_order_idは、insertメソッドで新しいレコードを挿入する際に、orderのorder_idを指定するために使用されています。具体的には、givenメソッドでorder_activity_order_idにorder.order_idを指定しています。これにより、order_activityテーブルには、どの注文に関するアクティビティログであるかが示されます。 | True |
| [packages/evershop/src/modules/checkout/api/createShipment/createShipment.js](https://github.com/evershopcommerce/evershop/blob/bc7ee43cdadfb8a00e896c8f753da75938507854/packages/evershop/src/modules/checkout/api/createShipment/createShipment.js) | このコードでは、テーブルorder_activityのカラムorder_activity_order_idは、新しいshipmentが作成されたときに、そのshipmentが属するorderのIDを示すために使用されています。具体的には、以下のコードで使用されています。<br><br>```<br>await insert('order_activity')<br>  .given({<br>    order_activity_order_id: order.order_id,<br>    comment: 'Order was fullfilled',<br>    customer_notified: 0<br>  })<br>  .execute(connection);<br>```<br><br>このコードは、新しいshipmentが作成された後、order_activityテーブルに新しい行を挿入します。この行には、order_activity_order_idカラムにorderのIDが設定され、commentカラムに「Order was fullfilled」というコメントが設定されます。 | True |
| [packages/evershop/src/modules/paypal/api/paypalCapturePayment/[bodyParser]capture.js](https://github.com/evershopcommerce/evershop/blob/bc7ee43cdadfb8a00e896c8f753da75938507854/packages/evershop/src/modules/paypal/api/paypalCapturePayment/[bodyParser]capture.js) | このコードでは、テーブルorder_activityのカラムorder_activity_order_idは、注文の活動を保存するために使用されています。具体的には、注文の支払いがPayPalを使用して行われた場合、注文の活動がorder_activityテーブルに追加されます。この際、order_activity_order_idカラムには、支払いが行われた注文の注文IDが格納されます。 | True |
| [packages/evershop/src/modules/paypal/api/paypalAuthorizePayment/[bodyParser]authorize.js](https://github.com/evershopcommerce/evershop/blob/bc7ee43cdadfb8a00e896c8f753da75938507854/packages/evershop/src/modules/paypal/api/paypalAuthorizePayment/[bodyParser]authorize.js) | このコードでは、テーブルorder_activityのカラムorder_activity_order_idは、注文の活動を保存するために使用されています。具体的には、注文の活動を保存するために、insertメソッドが使用されています。このメソッドは、order_activityテーブルに新しい行を挿入し、order_activity_order_idカラムには、注文のIDが設定されます。また、注文の活動に関する情報も、commentカラムに保存されます。 | True |
| [packages/evershop/src/modules/stripe/api/stripeWebHook/[bodyJson]webhook.js](https://github.com/evershopcommerce/evershop/blob/bc7ee43cdadfb8a00e896c8f753da75938507854/packages/evershop/src/modules/stripe/api/stripeWebHook/[bodyJson]webhook.js) | <br><br>このコードでは、テーブルorder_activityのカラムorder_activity_order_idは、注文のアクティビティログを作成するために使用されています。具体的には、支払いが成功した場合、注文のorder_idがorder_activity_order_idに設定され、注文のアクティビティログが作成されます。このログには、支払いがクレジットカードを使用して行われたこと、トランザクションIDなどの情報が含まれます。 | True |
| [packages/evershop/src/modules/checkout/services/orderCreator.js](https://github.com/evershopcommerce/evershop/blob/bc7ee43cdadfb8a00e896c8f753da75938507854/packages/evershop/src/modules/checkout/services/orderCreator.js) | このコードでは、テーブルorder_activityのカラムorder_activity_order_idは、新しい注文が作成されたときに、その注文のIDが格納されます。具体的には、以下のコードで使用されています。<br><br>```<br>await insert('order_activity')<br>  .given({<br>    order_activity_order_id: order.insertId,<br>    comment: 'Order created',<br>    customer_notified: 0 // TODO: check config of SendGrid<br>  })<br>  .execute(connection);<br>```<br><br>このコードは、新しい注文が作成されたときに、注文活動を表すレコードをorder_activityテーブルに挿入します。order_activity_order_idカラムには、新しい注文のIDが格納されます。 | True |
| [packages/evershop/src/modules/checkout/graphql/types/Order/Order.resolvers.js](https://github.com/evershopcommerce/evershop/blob/47620ae98869cea2f1d7bf2a46af54b0a43a64fa/packages/evershop/src/modules/checkout/graphql/types/Order/Order.resolvers.js) | このコードでは、テーブルorder_activityのカラムorder_activity_order_idは、orderのactivitiesフィールドを取得するためのクエリで使用されています。具体的には、orderのidとorder_activityのorder_activity_order_idを比較して、一致するレコードを取得しています。 | True |
[Back to order_activity](../tables/order_activity.md)